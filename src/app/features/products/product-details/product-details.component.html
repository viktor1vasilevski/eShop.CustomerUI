<div class="container-fluid py-4 px-5" style="min-height: 80vh">
  <!-- PRODUCT SECTION -->
  <div class="row g-4">
    <div class="col-lg-9 col-md-8">
      <div class="card product-card">
        <!-- Header -->
        <div class="card-header">
          <h2 class="fw-bold mb-0">{{ product.name }}</h2>
        </div>

        <div class="card-body d-flex flex-column flex-md-row p-4">
          <!-- Image -->
          <div class="product-image-box large me-md-4">
            <img [src]="product.image" [alt]="product.name" class="img-fluid" />
          </div>

          <!-- Product Info -->
          <div class="flex-grow-1">
            <h3 class="text-success fw-bold mb-3">${{ product.price }}</h3>
            <p class="text-muted">{{ product.description }}</p>

            <!-- Category tags -->
            <div class="mb-3">
              <span class="badge bg-primary me-2">
                {{ product.category }}
              </span>
              <span
                class="badge bg-warning text-dark"
                *ngIf="product.subcategory"
              >
                {{ product.subcategory }}
              </span>
            </div>

            <!-- Stock info -->
            <p class="text-muted">
              <i class="bi bi-box-seam me-1"></i>
              {{ product.unitQuantity }} in stock
            </p>
          </div>
        </div>
      </div>
    </div>

    <div class="col-lg-3 col-md-4">
      <div class="card add-to-cart">
        <div>
          <h5 class="fw-bold mb-3 text-dark">
            <i class="bi bi-cart3 me-2 text-success"></i> Add to Cart
          </h5>

          <!-- Price highlight -->
          <div class="mb-3">
            <span class="fw-semibold">Price:</span>
            <span class="text-success fs-4 fw-bold">
              ${{ product.price }}
            </span>
          </div>

          <!-- Quantity input -->
          <label for="quantity" class="form-label fw-semibold">Quantity</label>
          <input
            id="quantity"
            type="number"
            class="form-control mb-3"
            [(ngModel)]="quantity"
            min="1"
            [max]="product.unitQuantity"
          />
        </div>

        <!-- CTA button -->
        <button class="btn btn-lg btn-success w-100" (click)="addToBasket()">
          <i class="bi bi-bag-plus me-2"></i> Add to Basket
        </button>
      </div>
    </div>
  </div>

  <!-- COMMENTS / REVIEWS SECTION -->
  <div class="card comments-section mt-5">
    <div class="card-header">
      <span><i class="bi bi-star-half me-2"></i> Customer Reviews</span>
    </div>

    <div class="card-body p-4">
      <!-- Add Review -->
      <div *ngIf="canComment" class="mb-4">
        <h6 class="fw-bold mb-2">Write a Review</h6>
        <textarea
          [(ngModel)]="newCommentText"
          class="form-control mb-2"
          rows="3"
          placeholder="Share your thoughts..."
        ></textarea>

        <div class="mb-3">
          <label class="form-label fw-semibold">Rating</label>
          <select class="form-select" [(ngModel)]="newCommentRating">
            <option [value]="0" disabled>Select rating</option>
            <option *ngFor="let r of [1, 2, 3, 4, 5]" [value]="r">
              {{ r }} star{{ r > 1 ? "s" : "" }}
            </option>
          </select>
        </div>

        <button class="btn btn-success" (click)="submitComment()">
          <i class="bi bi-send me-2"></i> Submit Review
        </button>
      </div>

      <!-- Reviews List -->
      <div *ngIf="comments && comments.length > 0; else noReviews">
        <div class="d-flex flex-column gap-3">
          <div
            class="comment-card"
            *ngFor="let comment of comments; let i = index"
          >
            <div class="d-flex justify-content-between mb-2">
              <div class="d-flex align-items-center">
                <div class="comment-avatar me-2">
                  {{ comment.createdBy[0] | uppercase }}
                </div>
                <strong>{{ comment.createdBy }}</strong>
              </div>
              <small class="text-muted">
                {{ comment.created | date : "dd/MM/yyyy HH:mm" }}
              </small>
            </div>

            <p class="mb-2">{{ comment.commentText }}</p>

            <div>
              <ng-container *ngFor="let star of [1, 2, 3, 4, 5]">
                <i
                  class="bi"
                  [ngClass]="
                    star <= comment.rating
                      ? 'bi-star-fill text-warning'
                      : 'bi-star text-muted'
                  "
                ></i>
              </ng-container>
            </div>
          </div>
        </div>
      </div>

      <ng-template #noReviews>
        <p class="text-center text-muted">No reviews yet. Be the first!</p>
      </ng-template>
    </div>
  </div>
</div>
